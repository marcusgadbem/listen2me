/*! listen-2-me - v1.0.0 - 2014-08-16
* Copyright (c) 2014 ; Licensed  */

function safeEncodeURIComponent(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),$C=function(a){var b={};return function(c,d){return(void 0===b[c]||d)&&(b[c]=a(c)),b[c]}}($),$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})};var Player=function(){"use strict";function a(){console.log("Player.init...")}function b(){var a=Playlist.data();if(!j&&"undefined"==typeof a[0])return console.log("tÃ¡ vazio viado"),!1;var b=a[0].video_id;h=new YT.Player("player-embed",{height:"218",width:"387",videoId:b,playerVars:{autoplay:0,controls:1},events:{onStateChange:c}}),j=!0,console.log("*** Starting YT.Player with videoId ",b)}function c(a){console.log("Player event data: ",a.data),a.data==YT.PlayerState.ENDED&&(console.log("PlayNext from onPlayerStateChange..."),e())}function d(a){for(var b,c=Playlist.data(),d=c.length,e=0;d>e;++e)if(c[e].video_id==a.video_id){b=e,k=e;break}f(a)}function e(){var a=Playlist.data();if(++k,k>a.length)return UI.actionLogger({message:"Playlist ended!!! :(",thumbnail:""}),!1;var b=Playlist.data()[k];f(b)}function f(a){i&&UI.getVideoDOM(i.video_id).removeClass("current-song"),UI.getVideoDOM(a.video_id).addClass("current-song"),h.loadVideoById(a.video_id,0),i=a}function g(){return j}var h,i,j=!1,k=0;return{init:a,onYouTubeIframeAPIReady:b,playVideoById:d,isEmbedded:g}}(),Playlist=function(){"use strict";function a(){console.log("Playlist.init..."),e=channelObj.playlist}function b(a){e.push(a),Player.isEmbedded()||Player.onYouTubeIframeAPIReady(),console.log("Data added: ",e)}function c(a){var b=e.length,c=0;for(c;b>c;++c)if(e[c].video_id==a.video_id){e.splice(c,1);break}console.log("Data removed: ",e)}function d(){return e}var e=[];return{init:a,data:d,pushSong:b,removeSong:c}}(),SearchController=function(){function a(){$(".js--video-search-form").submit(function(a){e=$(this).serializeObject(),b(),a.preventDefault()})}function b(a){var b=c(a);return $.ajax({url:b,method:"GET",dataType:"JSON",success:function(a){console.log("Success: ",a),d(a)},error:function(a){console.log("Error: ",a)},fail:function(a,b,c){console.log("Request failed: "+b),console.log(c)}})}function c(){g.URIOptions.q=e.search_term,void 0!==g.nextSearch.nextPageToken&&(g.URIOptions.pageToken=g.nextSearch.nextPageToken);var a=safeEncodeURIComponent(g.URIOptions);return[g.baseUrl,a].join("")}function d(a){return f=[],g.nextSearch.nextPageToken=a.nextPageToken?a.nextPageToken:void 0,$.each(a.items,function(a,b){f.push({video_id:b.id.videoId,video_title:b.snippet.title,video_description:b.snippet.description,video_thumbnails:b.snippet.thumbnails})}),UI.printSearchResult(f)}var e={},f=[],g={baseUrl:"https://www.googleapis.com/youtube/v3/search?",URIOptions:{v:"3",part:"id,snippet",type:"video",order:"relevance",safeSearch:"strict",q:"{search}",maxResults:"50",alt:"json",key:"AIzaSyAA0oE3aj4jlc5rSlstLozOwlPm10p5BaQ"},nextSearch:{}};return{init:a}}(),socketsController=function(){"use strict";function a(){console.log("* Sockets Init..."),l=".dev"===document.domain.substr(-4)?[document.domain,":8000"].join(""):document.domain,k=io.connect(["http://",l].join("")),k.on("connect",function(){console.log("Connected!")}),k.on("create_user",b),k.on("join",c),k.on("part",d),k.on("add_song",e),k.on("del_song",f),k.on("error",g)}function b(a){n=a.user,h(channelObj)}function c(a){console.log("[ User has joined # ",a.user.username," ]");var b=a.user.username;UI.actionLogger({message:b+" has joined channel",thumbnail:a.user.thumbnail}),UI.updateOnlineUsers(a.roomCount)}function d(a){console.log("[ User has left # ",a.user.username," ]");var b=a.user.username;UI.actionLogger({message:b+" has left channel",thumbnail:a.user.thumbnail}),UI.updateOnlineUsers(a.roomCount)}function e(a){console.log("[ User has added song # ",a," ]"),console.log("Video: ",a);var b=a.user.username==n.username?"YOU!":a.user.username;a.video.prettyOwner=b,a.video.owner==n._id&&(a.video.mine=!0),Playlist.pushSong(a.video),UI.updateSongsCount(),UI.printPlaylistItem(a.video),UI.actionLogger({message:b+" has added "+a.video.video_title,thumbnail:a.video.video_thumbnails})}function f(a){console.log("[ User has deleted song # ",a," ]");var b=a.user.username==n.username?"YOU!":a.user.username;Playlist.removeSong(a.video),UI.updateSongsCount(),UI.removePlaylistItem(a.video),UI.actionLogger({message:b+" has removed "+a.video.video_title,thumbnail:a.video.video_thumbnails})}function g(a){console.log("[ An error has occured: ",a," ]")}function h(a){k.emit("join",a),m=a}function i(a){k.emit("add_song",a)}function j(a){k.emit("del_song",a)}var k=null,l=null,m={},n={};return{init:a,addSong:i,delSong:j}}(),UI=function(){"use strict";function a(){$("#search--result").delegate(".result--item","click",function(a){console.log("Live click");var b=$(this).clone(),c={video_id:b.data("video-id"),video_title:b.data("video-title"),video_thumbnails:b.data("video-thumbnail")};console.log("*** EMIT: ",c),socketsController.addSong(c),a.preventDefault()}),$("#playlist").delegate(".video--remove","click",function(a){console.log("Live click");var b=$(this).parent().parent(),c={video_id:b.data("video-id"),video_title:b.data("video-title"),video_thumbnails:b.data("video-thumbnail")};console.log("*** EMIT: ",c),socketsController.delSong(c),a.preventDefault()}),$("#playlist").delegate(".video--title","click",function(a){var b=$(this).parent().parent(),c={video_id:b.data("video-id"),video_title:b.data("video-title"),video_thumbnails:b.data("video-thumbnail")};console.log("*** Playing... ",c.video_title),Player.playVideoById(c),a.preventDefault()});var a=$("#events--wrapper");a.bind("DOMSubtreeModified",function(){a.children().length>=8&&a.children().last().fadeOut("slow",function(){$(this).remove()})})}function b(a){var b=tmpl("template-playlist-item",a);$(b).hide().appendTo(".room-playlist-tracks").fadeIn("slow")}function c(a){console.log("Removing ",a),d(a.video_id).remove()}function d(a){var b=b||$("#playlist");return b.find('div[data-video-id="'+a+'"]')}function e(a){return $("#search--result").empty(),$.each(a,function(a,b){var c=tmpl("template-search-result-item",b);$(c).hide().appendTo("#search--result").fadeIn("slow")})}function f(a){var b={thumbnail:a.thumbnail,event_content:a.message},c=tmpl("template-event-item",b);$(c).hide().prependTo("#events--wrapper").fadeIn("slow")}function g(a){$("#js--online-users").html(a)}function h(){$("#js--playlist-count").html(Playlist.data().length)}return{init:a,printSearchResult:e,printPlaylistItem:b,removePlaylistItem:c,actionLogger:f,updateOnlineUsers:g,updateSongsCount:h,getVideoDOM:d}}();
//# sourceMappingURL=application.js.map